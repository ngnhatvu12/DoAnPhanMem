@model DoAnPhanMem.ViewModels.ProductDetailViewModel2

@{
    ViewData["Title"] = Model.SanPham.TenSanPham;
    Layout = "~/Views/Shared/_LayoutOgani2.cshtml";
             <link rel="stylesheet" href="~/css/CartPopup.css" />
}

    <div class="container" style="max-width:100%">
        <div class="left-column">
            <div class="product-image">
            @if (!string.IsNullOrEmpty(Model.SanPham.HinhAnh))
            {
                        <img src="~/LayoutOgani/img/@Model.SanPham.HinhAnh" alt="@Model.SanPham.TenSanPham" class="main-product-image" />
            }
            else
            {
                        <img src="~/img/no-image.png" alt="No Image" />
            }
            </div>
            <div class="thumbnail-images">
            @foreach (var ctp in Model.ChiTietSanPhamList)
            {
                    <img src="~/LayoutOgani/img/@ctp.HinhAnhBienThe" alt="Ảnh biến thể" />
            }
            </div>
        </div>
        <div class="right-column">
            <div class="product-title">
            @Model.SanPham.TenSanPham
            </div>
            <div class="product-code">
                Mã sản phẩm: @Model.SanPham.MaSanPham
            </div>
            <div class="price">
                Giá gốc: <span class="original-price">@Model.SanPham.GiaBan đ</span>
            @if (Model.SanPham.GiaGiam > 0)
            {
                        <span class="discount-price">Giá giảm: @Model.SanPham.GiaGiam đ</span>
            }
            </div>
        <div class="product-description">
            <h2>Mô tả chi tiết</h2>
            <p>@Model.SanPham.MoTa</p>
        </div>
            <div class="size-selection">
                <span>Size:</span>
                <select id="size-selector">
                @foreach (var ctp in Model.ChiTietSanPhamList.Select(c => c.TenKichThuoc).Distinct())
                {
                        <option value="@ctp">@ctp</option>
                }
                </select>
            </div>
            <div class="color-selection">
                <span>Màu sắc:</span>
                <select id="color-selector">
                @foreach (var ctp in Model.ChiTietSanPhamList.Select(c => c.TenMauSac).Distinct())
                {
                        <option value="@ctp">@ctp</option>
                }
                </select>
            </div>
            <div class="quantity">
                <span>Số lượng:</span>
                <button>-</button>
                <input type="text" value="1" />
                <button>+</button>
            </div>
            <button class="buy-now" onclick="orderProduct()">MUA NGAY</button>
            <a href="/Cart/AddToCart?id=@Model.SanPham.MaSanPham" class="btn btn-add-to-cart">
                <i class="fa fa-shopping-cart"></i> Thêm vào giỏ hàng
            </a>
            <ul class="services">
                <li><i class="fas fa-truck"></i> GIAO HÀNG MIỄN PHÍ</li>
                <li><i class="fas fa-sync-alt"></i> ĐỔI TRẢ MIỄN PHÍ</li>
                <li><i class="fas fa-credit-card"></i> THANH TOÁN</li>
                <li><i class="fas fa-phone"></i> HỖ TRỢ MUA NHANH: 0975481014</li>
            </ul>
            <div class="info">
                <strong>VIBLO</strong> xin cam kết về chất lượng trong từng sản phẩm, chúng tôi tuyệt đối không bán hàng fake, hàng kém chất lượng. Nếu quý khách nhận thấy hàng không đúng như mô tả, chúng tôi sẽ tiến hành cho đổi trả và hoàn tiền 100%. Sản phẩm trên hình có thể khác ngoài đời do ánh sáng và góc độ chụp ảnh.
            </div>
        </div>
    </div>
<div class="comments-section">
    <h3>Đánh giá sản phẩm</h3>
    @foreach (var danhGia in Model.DanhGiaList)
    {
            <div class="comment-item">
                <p><strong>@danhGia.TenKhachHang</strong> - <small>@danhGia.NgayDanhGia.ToString("dd/MM/yyyy")</small></p>
                <div class="star-rating">
                @for (int i = 1; i <= 5; i++)
                {
                            <span class="star @(i <= danhGia.SoDiem ? "star-gold" : "star-gray")">&#9733;</span>
                }
                </div>
                <p>@danhGia.BinhLuan</p>
            </div>
    }
</div>

<script>
    function orderProduct() {
        // Logic đặt hàng có thể được thêm vào đây
        alert("Sản phẩm đã được đặt hàng!");
    }
    function updateCartCount() {
        $.ajax({
            url: '/Cart/GetCartDetails',
            type: 'GET',
            success: function (response) {
                if (response.success) {
                    const itemCount = response.totalQuantity;
                    $('.cart span').text(`(${itemCount})`);
                }
            },
            error: function (error) {
                console.error("Lỗi khi lấy số lượng giỏ hàng.", error);
            }
        });
    }
    function openCartPopup() {
        $.ajax({
            url: '/Cart/GetCartDetails',
            method: 'GET',
            success: function (response) {
                if (response.success) {
                    let cartItems = response.cartItems;
                    let totalQuantity = response.totalQuantity;

                    $('.cart-popup').remove();

                    let cartHtml = `<div class="cart-popup">
                        <div class="cart-popup-header">
                            <h4 class="cart-title">Giỏ hàng của bạn <span class="badge">${totalQuantity}</span></h4>
                            <button class="close-btn" onclick="closeCartPopup()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="cart-items-container">
                            <ul>`;

                    cartHtml += cartItems.map(item => {
                        const formattedPrice = (item.giaBan || 0).toLocaleString('vi-VN') + '₫';
                        return `<li>
                            <img src="/LayoutOgani/img/${item.hinhAnh || 'default-image.jpg'}" alt="${item.tenSanPham || 'Sản phẩm'}">
                            <div class="item-info">
                                <h6>${item.tenSanPham || 'Sản phẩm không tên'}</h6>
                                <p>Màu sắc: ${item.mauSac || 'N/A'}</p>
                                <p>Kích thước: ${item.kichThuoc || 'N/A'}</p>
                                <p>${formattedPrice} × ${item.soLuong || 1}</p>
                            </div>
                            <button onclick="removeCartItem('${item.maSanPham}', '${item.mauSac}', '${item.kichThuoc}')">X</button>
                        </li>`;
                    }).join("");

                    cartHtml += `</ul>
                        </div>
                        <div class="cart-popup-footer">
                            <div class="cart-summary">
                                <span>Tổng cộng:</span>
                                <span class="total-price">${(response.totalPrice || 0).toLocaleString('vi-VN')}₫</span>
                            </div>
                            <div class="cart-actions">
                                <button class="btn checkout-btn" onclick="viewCartDetails()">Thanh toán</button>
                            </div>
                        </div>
                    </div>`;

                    $('body').append(cartHtml);

                    // Định vị trí cho popup
                    const cartButton = $('.btn.cart');
                    const buttonOffset = cartButton.offset();

                    $('.cart-popup').css({
                        top: buttonOffset.top + cartButton.outerHeight() + 10,
                        left: buttonOffset.left - 350
                    });

                    // Hiệu ứng xuất hiện
                    setTimeout(() => {
                        $('.cart-popup').addClass('show');
                    }, 10);
                }
            }
        });
    }

    function viewCartDetails() {
        window.location.href = "/Cart/Index";
    }
    $(document).ready(function () {
    $(document).on('click', function (event) {
        if (!$(event.target).closest('.btn.cart, .cart-popup').length) {
            $('.cart-popup').remove(); 
        }
    });
});
$(document).on('click', '.cart-popup', function (event) {
    event.stopPropagation(); 
}); 

    $('#cartPopup').on('click', function (e) {
        e.stopPropagation();
    });
</script>
<style>
    /* ===== PRODUCT DETAIL PAGE REDESIGN ===== */
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #f8f9fa;
        color: #333;
        line-height: 1.6;
    }

    .container {
        max-width: 100%;
        margin: 30px auto;
        padding: 0 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
    }

    /* Left Column - Product Images */
    .left-column {
        flex: 1;
        min-width: 300px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        padding: 20px;
    }

    .product-image {
        margin-bottom: 20px;
        text-align: center;
        border: 1px solid #eee;
        padding: 15px;
        border-radius: 8px;
    }

        .product-image img {
            max-width: 100%;
            height: 850px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

            .product-image img:hover {
                transform: scale(1.02);
            }

    .thumbnail-images {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
    }

        .thumbnail-images img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .thumbnail-images img:hover {
                border-color: #3498db;
                transform: translateY(-3px);
            }

    /* Right Column - Product Info */
    .right-column {
        flex: 1;
        min-width: 300px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        padding: 30px;
    }

    .product-title {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
        line-height: 1.3;
    }

    .product-code {
        color: #7f8c8d;
        font-size: 14px;
        margin-bottom: 20px;
    }

    .price {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }

    .original-price {
        font-size: 22px;
        color: #7f8c8d;
        text-decoration: line-through;
        margin-right: 15px;
    }

    .discount-price {
        font-size: 28px;
        font-weight: 700;
        color: #e74c3c;
    }

    .product-description {
        margin: 30px 0;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }

        .product-description h2 {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .product-description p {
            color: #555;
            font-size: 15px;
            line-height: 1.7;
        }

    /* Variant Selectors */
    .size-selection,
    .color-selection {
        margin-bottom: 20px;
    }

        .size-selection span,
        .color-selection span {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

    #size-selector,
    #color-selector {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #f8f9fa;
        font-size: 15px;
        transition: all 0.3s;
    }

        #size-selector:focus,
        #color-selector:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }

    /* Quantity Selector */
    .quantity {
        display: flex;
        align-items: center;
        margin: 25px 0;
    }

        .quantity span {
            font-weight: 600;
            margin-right: 15px;
            color: #2c3e50;
        }

        .quantity button {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

            .quantity button:hover {
                background: #e0e0e0;
            }

        .quantity input {
            width: 60px;
            height: 40px;
            text-align: center;
            border: 1px solid #ddd;
            border-left: none;
            border-right: none;
            font-size: 16px;
        }

    /* Action Buttons */
    .buy-now {
        display: block;
        width: 100%;
        padding: 15px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 15px;
        transition: all 0.3s;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

        .buy-now:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

    .btn-add-to-cart {
        display: block;
        width: 100%;
        padding: 15px;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 25px;
        transition: all 0.3s;
        text-align: center;
        text-decoration: none;
    }

        .btn-add-to-cart:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-add-to-cart i {
            margin-right: 8px;
        }

    /* Services */
    .services {
        list-style: none;
        padding: 0;
        margin: 25px 0;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

        .services li {
            padding: 10px 0;
            color: #555;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .services i {
            color: #3498db;
            margin-right: 10px;
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

    /* Info Box */
    .info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        font-size: 14px;
        color: #555;
        line-height: 1.7;
        border-left: 3px solid #3498db;
    }

        .info strong {
            color: #2c3e50;
        }

    /* Comments Section */
    .comments-section {
        width: 100%;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        padding: 30px;
        margin-top: 30px;
    }

        .comments-section h3 {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }

    .comment-item {
        padding: 20px 0;
        border-bottom: 1px solid #eee;
    }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-item p:first-child {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .comment-item strong {
            color: #2c3e50;
            margin-right: 10px;
        }

        .comment-item small {
            color: #7f8c8d;
            font-size: 13px;
        }

    .star-rating {
        margin: 5px 0;
    }

    .star-gold {
        color: #f1c40f;
    }

    .star-gray {
        color: #ddd;
    }

    .comment-item p:last-child {
        color: #555;
        font-size: 14px;
        line-height: 1.7;
    }

    @@media (max-width: 768px) {
        .container {
            flex-direction: column;
        }

        .left-column,
        .right-column {
            width: 100%;
        }

        .product-title {
            font-size: 24px;
        }

        .discount-price {
            font-size: 24px;
        }
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .product-image,
    .right-column,
    .comments-section {
        animation: fadeIn 0.5s ease-out forwards;
    }

    .right-column {
        animation-delay: 0.1s;
    }

    .comments-section {
        animation-delay: 0.2s;
    }
</style>